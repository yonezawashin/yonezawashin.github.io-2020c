<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>シューティングゲーム 1</title>
    <link rel="stylesheet" href="style.css">
    <style>
      
    </style>
  </head>
  <body>
    <p class="title">[C++移植]シューティングゲーム 1</p>
    <br>
    <ol id="mozToc">
      <!--mozToc h1 1-->
      <li><a href="#mozTocId816363">シューティングのC++移植で目指すところ(意義)</a></li>
      <li><a href="#mozTocId488915">プロジェクトの作成</a></li>
      <li><a href="#mozTocId53452">便利クラスの追加</a></li>
      <li><a href="#mozTocId522169">画像ファイルの追加</a></li>
      <li><a href="#mozTocId848225">Imageクラスの作成</a></li>
      <li><a href="#mozTocId300175">自機の作成</a></li>
      <li><a href="#mozTocId514412">自機弾の作成</a></li>
      <li><a href="#mozTocId668068">敵の作成</a></li>
    </ol>
    <h1><a id="mozTocId816363" class="mozTocH1"></a>シューティングのC++移植で目指すところ(意義)</h1>
    <p>前期でやったシューティングの制作をC++に移植することで以下を作業を通じて【体得しよう】。</p>
    <ul>
      <li>C++でのクラス定義をC#との違いを比較しながら習得</li>
      <li>C++ではないがDXライブラリの公式のサンプルはC++なのでそれを動かせるようになる</li>
      <li>C++でのリストやforeachの使い方の違いを習得</li>
      <li>C++での画像読み込みとそのメモリのお掃除(メモリ開放)</li>
    </ul>
    <p>別途[クラスの基本(C++11).pdf]の解説を参考にしながらC++のクラス定義に慣れてゆきましょう</p>
    <p>最終的には、C++で制作したゲームの提出をしてもらいます（その出来で後期の成績が決まります）。<br>
      頑張ってください！</p>
    <p></p>
    <h1><a id="mozTocId488915" class="mozTocH1"></a>プロジェクトの作成</h1>
    <h2>まずはDXライブラリ公式のC++のライブラリをダウンロード</h2>
    以下のDXライブラリの公式サイトからC++のDXライブラリをダウンロードしてください。<br>
    <a href="https://dxlib.xsrv.jp/dxdload.html">https://dxlib.xsrv.jp/dxdload.html</a>
	<br>ダウンロードできたらzipファイルを【C:ドライブ直下に展開】してください<br>
	<p> <img src="image/img_dxdownload.png" alt="" style="width: 1243px; height: 869px;"></p><br><br>
    
    <h2>ダウンロードできたらzipファイルを【C:ドライブ直下に展開】</h2>
    <p> <img src="image/img_dxlibextract_c_drive.png" alt="" style="width: 1129px; height: 402px;"></p><br><br>
    
    
    <h2>プロジェクト作成</h2>
    Visual Studio 2019を起動してください。<br>
    <br>
    起動したら、<code>新しいプロジェクトの作成</code>をクリック<br>
    <br>
    <code>C++ 空のプロジェクト</code>を選択して次へ
    <p> <img src="image/making_cpp_prj.png" alt="" style="width: 1156px; height: 853px;"></p>
    <p>今回のプロジェクト名は【1】「自分の作るゲーム名」か【2】毎回C++のプロジェクトを作るのが面倒な人は今回作るプロジェクトをフォルダごと量産するとして「DXLibGameBase」(ゲームの基礎ベース、コピペで量産用プロジェクト)にしましょう。</p>
    プロジェクトが作成されたら、とりあえずF5で実行して、ウィンドウが出ることを確認しましょう。 <br>
    
    <h2>次にプロジェクトのややこしい設定をしっかりやる</h2>
	プロジェクトの【設定を開く前に】最低限一つだけでもcppファイルがプロジェクトにないと【出てこない設定項目がある】ので新しい項目をついかでC++ソースファイル(.cpp)のファイルを一つ作成しておく。<br>
    <br>
    <p> <img src="image/need_one_cpp.png" alt="" style="width: 1152px; height: 713px;"></p>
    <br>
    一つだけcppファイルを作成した後、プロジェクトを右クリックして<code>プロパティ</code>をクリック<br>
    <br>
    <p> <img src="image/open_setting.png" alt="" style="width: 1128px; height: 642px;"></p>
    <br>    
    
    <h2>【設定】マルチバイト文字セットを使用</h2>
    <br>
    設定画面の【構成プロパティ】→【詳細】の【文字セット】を<code>マルチバイト文字セットを使用</code>に変更<br>
    <p> <img src="image/setting_multibyte_moji.png" alt="" style="width: 982px; height: 682px;"></p>
    <br>


    <h2>【設定】C/C++→全般→追加のインクルードディレクトリにDXライブラリのフォルダ位置(PATH)を追加</h2>
    <br>
    設定画面の【C/C++全般】→【全般】の【追加のインクルードディレクトリ】に<code>DXライブラリのフォルダ位置(PATH)</code>を設定<br>
    <p> <img src="image/setting_cpp_add_include_dir.png" alt="" style="width: 1047px; height: 682px;"></p>
    <br>
    フォルダのパス(位置)文字列は以下のgifアニメのようにコピーして貼り付け<br>
    <p> <img src="image/setting_howto_copy_dir.gif" alt="" style="width: 892px; height: 554px;"></p>
    <br>

    <h2>【設定】リンカ→全般→追加のライブラリディレクトリにDXライブラリのフォルダ位置(PATH)を追加</h2>
    <br>
    設定画面の【リンカー】→【全般】の【追加のライブラリディレクトリ】に<code>DXライブラリのフォルダ位置(PATH)</code>を設定<br>
    <p> <img src="image/setting_linker_add_lib_dir.png" alt="" style="width: 1046px; height: 682px;"></p>
    <br>
    フォルダのパス(位置)文字列は以下のgifアニメのようにコピーしたものを貼り付け<br>
    <p> <img src="image/setting_howto_paste_dir.gif" alt="" style="width: 1075px; height: 805px;"></p>
    <br>

<br>

    
    <h2>【設定】リンカ→システム→サブシステムをウィンドウに(コンソールのままだと黒画面の文字ベースシステムになる)</h2>
    
    <br>
    設定画面の【リンカー】→【システム】の【サブシステム】を<code>Windows(SUBSYSTEM:WINDOWS)</code>に設定<br>
    この設定をするとプログラムの開始位置(エントリポイントという)がWinMainというところから始まるようになる。(Consoleの場合はMain)<br>
    <p> <img src="image/setting_entry_point.png" alt="" style="width: 985px; height: 682px;"></p>
    <br>
    
    <br>
    以上で設定項目は終わり。OKをおして設定を反映しよう<br>

    <br>
<br>
	<h2>設定を反映させたらサンプルプログラムをmain.cppにコピペして動作を確認</h2>
    <p>以下の【ウィンドウを出すだけの最小限サンプル】を動かして設定を確認しましょう</p>
    <p><code>main.cpp【ウィンドウを出すだけの最小限サンプル】</code>を編集します：</p>
    <p class="source">#include "DxLib.h"<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( 960 , 540 , 32 ) ; // 画面サイズ960×540のカラービット数32ビットで起動<br>

&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(960, 540);// ウィンドウサイズ960×540(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>


&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;// この位置にウィンドウの中に画像を描く処理などを書く<br>
&nbsp;&nbsp;// DXライブラリ公式の色々なサンプルを試してみよう！<br>
&nbsp;&nbsp;// https://dxlib.xsrv.jp/dxfunc.html<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>


&nbsp;&nbsp;// キー入力待ちをする<br>
&nbsp;&nbsp;WaitKey();<br>

&nbsp;&nbsp;// ＤＸライブラリの後始末<br>
&nbsp;&nbsp;DxLib_End();<br>

&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>


    
    <h2>解像度の定義</h2>
    <p>【C++で】画面解像度を定義するクラスを作ってみましょう。ソリューションエクスプローラーのプロジェクトを右クリックし、追加＞ヘッダファイル(.h)<br>
      Screen.hという名前でヘッダファイルを生成し、そのファイルにクラスを記述します。</p>
    <p><code>Screen.h</code>を編集します：</p>
    <p class="source">#ifndef _SCREEN_H<br>
#define _SCREEN_H<br>
// ＃ifndefは「_SCREEN_H」がifもしもn(not) def(定義)されていないなら＃endifに挟まれたコードまでを有効化する(だから2度目以降は無効になる)<br>
// 二重定義を防止するために＃から始まる【プリプロセッサ】を使っている<br>
//　【プリプロセッサ】はビルドする段階でコード自体に【前処理】として影響を与える<br>
// たとえば<br>
// ・ファイルの読み込み (including) →＃includeがこれ<br>
// ・マクロの展開（シンボルを、あらかじめ定義された規則に従って置換する）<br>
// ・コンパイル条件によるソースコードの部分的選択→【＃ifndef　～ ＃endifに囲まれた部分】は一度(＃defineで)定義されると無効化<br>
// ・コメントの削除 【&nbsp;//&nbsp;】のコメントの削除も【プリプロセス＝前段階で行われる】<br>
<br>
// 画面解像度<br>
class Screen<br>
{<br>
public: //publicはC＃と違いpublic:以下にまとめて書かれるスタイル<br>
&nbsp;&nbsp;static const int Width = 960; // 幅<br>
&nbsp;&nbsp;static const int Height = 540; // 高さ C＃と違いstaticクラスではなく個々の【すべての変数にstaticをつけて】staticなクラスとする<br>
};// C＃と違ってクラスの定義も;セミコロンで終わる<br>

#endif</p>
<br>
<br>
<br>
    <p><code>main.cpp</code>を編集してScreen.hを読み込ませます：</p>
    <p class="source">#include "DxLib.h"<br>
    <em>#include "Screen.h"</em><br>
// ＃includeで別ファイルのヘッダファイル.hをこのコード内に読み込む<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( <em>Screen::Width, Screen::Height,</em> 32 ) ; // 画面サイズWidth×Heightのカラービット数32ビットで起動<br>
<br>
&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(<em>Screen::Width, Screen::Height</em>);// ウィンドウサイズWidth×Height(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>
<br>
&nbsp;&nbsp;// (中略).....................................<br>
<br>
&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>



    <h1><a id="mozTocId53452" class="mozTocH1"></a>画像ファイルの追加</h1>
    <p>次は画像ファイルをプロジェクトに追加します。【C#と違い】フォルダは【ウィンドウズ上のエクスプローラで作成】します。<br>
    <br>
    <br>
    <img src="image/open_folder_with_explorer.png" alt="" style="width: 1397px; height: 475px;"><br>
    <br>
    <img src="image/new_image_folder.png" alt="" style="width: 362px; height: 180px;"><br>
	<br>
	<br>
      「素材」フォルダー内の「画像」フォルダーにあるおなじみのボス画像を、【C#と違い】下のアニメようにウィンドウズでImageフォルダーにコピーして貼り付けしてください。</p>
    <img src="image/image_copy_paste.gif" alt=""><br>
    <br>
    <img src="image/image_add_project.gif" alt=""><br>

    <p><br>
    </p>
    
    <h2>試しに表示してみる</h2>
    <p><code>main.cpp</code>にプログラムを追加し、画像が正しく表示できるかテストします。</p>
    <p class="source">#include "DxLib.h"<br>
    <em>#include &lt;assert.h&gt;&nbsp;// 画像読み込みの読込み失敗表示用</em><br>
    #include "Screen.h"<br>
// ＃includeで別ファイルのヘッダファイル.hをこのコード内に読み込む<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( Screen::Width, Screen::Height, 32 ) ; // 画面サイズWidth×Heightのカラービット数32ビットで起動<br>
<br>
&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(Screen::Width, Screen::Height);// ウィンドウサイズWidth×Height(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>
<br>
<em>
&nbsp;&nbsp;//表示しているスクリーンの後ろで隠れて次に描く画像を先に描くモード<br>
&nbsp;&nbsp;// これとペアでScreenFlip();でつぎのページと入れ替えでちらつきを防ぐ<br>
&nbsp;&nbsp;SetDrawScreen(DX_SCREEN_BACK);<br>
<br>
&nbsp;&nbsp;// これまでInitでやってきてた初期化処理<br>
&nbsp;&nbsp;int bossImage = -1;<br>
&nbsp;&nbsp;bossImage = LoadGraph("Image/boss1.png");<br>
&nbsp;&nbsp;assert(bossImage != -1); // 画像読込失敗、ファイル名かフォルダ名が間違ってる<br>
&nbsp;&nbsp;int x = 100; // Xの初期位置<br>
&nbsp;&nbsp;int vx = 10;<br>
<br>
&nbsp;&nbsp;ScreenFlip();<br>
<br>
&nbsp;&nbsp;// アニメーション(パラパラ漫画)するにはWhile文<br>
&nbsp;&nbsp;while (ProcessMessage() == 0) <br>
&nbsp;&nbsp;{// ProcessMessage() == 0になるのは×ボタン押したときなど<br>
&nbsp;&nbsp;&nbsp;&nbsp;ClearDrawScreen();// 一旦キャンバスをきれいにまっさらに<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// これまではUpdateでやってきてた更新処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (x &lt; 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = 10; //速度の変更<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (x &gt; Screen::Width)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = -10;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;x += vx; // X位置の更新<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// これまではDrawでやってきてた描画処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;DrawRotaGraphF(x, 200, 0.9f, 0, bossImage, TRUE);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;ScreenFlip(); //隠れて裏側で描いておいた画像を表面に入れ替え<br>
&nbsp;&nbsp;}<br></em>
<br>

&nbsp;&nbsp;// キー入力待ちをする<br>
&nbsp;&nbsp;WaitKey();<br>

&nbsp;&nbsp;// ＤＸライブラリの後始末<br>
&nbsp;&nbsp;DxLib_End();<br>

&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>
    <p><br>
    </p>

    
    
    <h1><a id="mozTocId522169" class="mozTocH1"></a>Imageクラスの作成</h1>
    <h2>Imageクラスの作成</h2>
    <p>Imageクラスを作成しましょう。Imageクラスの役割は次の2つです。</p>
    <ul>
      <li>画像の読み込み</li>
      <li>読み込んだ画像ハンドルの保持</li>
    </ul>
    <p><br>
    </p>
    <p>ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞ヘッダファイル<br>
      「Image」という名前でヘッダファイルを作り、クラスを定義します。<br>
      <br>
      <code>Image.h</code>の内容を次のようにします：</p>
    <p class="source">#include "DxLib.h"<br>
    #include &lt;assert.h&gt;&nbsp;// 画像読み込みの読込み失敗表示用<br>
<br>
#ifndef IMAGE_H_<br>
#define IMAGE_H_<br>
<br>
class Image<br>
{<br>
public:<br>
&nbsp;&nbsp;Image() {}; // 初期化コンストラクタの定義だけ<br>
&nbsp;&nbsp;~Image() {}; // 破棄する処理デストラクタの定義だけ<br>
&nbsp;&nbsp;static void Load();<br>
<br>
&nbsp;&nbsp;static int bossImage; //ボス画像のハンドラ(読込画像番号)<br>
<br>
private:<br>
<br>
};<br>
#endif<br>
</p>
<br>
<p>次に対となるcppファイルを作成します。<br>
ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞cppファイル<br>
      「Image」という名前でcppファイルを作り、クラスを実装します。<br>
      <br>
      <code>Image.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Image.h"<br>
<br>
int Image::bossImage{-1}; // Load終わっても-1(初期値)のままだと画像ロードが失敗してますね<br>
<br>
void Image::Load()<br>
{<br>
&nbsp;&nbsp;bossImage = LoadGraph("Image/boss1.png");<br>
&nbsp;&nbsp;assert(bossImage != -1); // 画像読込失敗、ファイル名かフォルダ名が間違ってる<br>
};</p>


<h2>とりあえずC++バージョンに変更できたのはここまで</h2>



</body>
</html>

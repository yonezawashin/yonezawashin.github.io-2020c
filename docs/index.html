<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>シューティングゲーム 1</title>
    <link rel="stylesheet" href="style.css">
    <style>
      
    </style>
  </head>
  <body>
    <p class="title">[C++移植]シューティングゲーム 1</p>
    <br>
    <ol id="mozToc">
      <!--mozToc h1 1-->
      <li><a href="#mozTocId816363">シューティングのC++移植で目指すところ(意義)</a></li>
      <li><a href="#mozTocId488915">プロジェクトの作成</a></li>
      <li><a href="#mozTocId53452">便利クラスの追加</a></li>
      <li><a href="#mozTocId522169">画像ファイルの追加</a></li>
      <li><a href="#mozTocId848225">Imageクラスの作成</a></li>
      <li><a href="#mozTocId300175">自機の作成</a></li>
      <li><a href="#mozTocId514412">自機弾の作成</a></li>
      <li><a href="#mozTocId668068">敵の作成</a></li>
    </ol>
    <h1><a id="mozTocId816363" class="mozTocH1"></a>シューティングのC++移植で目指すところ(意義)</h1>
    <p>前期でやったシューティングの制作をC++に移植することで以下を作業を通じて【体得しよう】。</p>
    <ul>
      <li>C++でのクラス定義をC#との違いを比較しながら習得</li>
      <li>C++ではないがDXライブラリの公式のサンプルはC++なのでそれを動かせるようになる</li>
      <li>C++でのリストやforeachの使い方の違いを習得</li>
      <li>C++での画像読み込みとそのメモリのお掃除(メモリ開放)</li>
    </ul>
    <p>別途[クラスの基本(C++11).pdf]の解説を参考にしながらC++のクラス定義に慣れてゆきましょう</p>
    <p>最終的には、C++で制作したゲームの提出をしてもらいます（その出来で後期の成績が決まります）。<br>
      頑張ってください！</p>
    <p></p>
    <h1><a id="mozTocId488915" class="mozTocH1"></a>プロジェクトの作成</h1>
    <h2>まずはDXライブラリ公式のC++のライブラリをダウンロード</h2>
    以下のDXライブラリの公式サイトからC++のDXライブラリをダウンロードしてください。<br>
    <a href="https://dxlib.xsrv.jp/dxdload.html">https://dxlib.xsrv.jp/dxdload.html</a>
	<br>ダウンロードできたらzipファイルを【C:ドライブ直下に展開】してください<br>
	<p> <img src="image/img_dxdownload.png" alt=""></p><br><br>
    
    <h2>ダウンロードできたらzipファイルを【C:ドライブ直下に展開】</h2>
    <p> <img src="image/img_dxlibextract_c_drive.png" alt=""></p><br><br>
    
    
    <h2>プロジェクト作成</h2>
    Visual Studio 2019を起動してください。<br>
    <br>
    起動したら、<code>新しいプロジェクトの作成</code>をクリック<br>
    <br>
    <code>C++ 空のプロジェクト</code>を選択して次へ
    <p> <img src="image/making_cpp_prj.png" alt="" style="width: 1156px; height: 853px;"></p>
    <p>今回のプロジェクト名は【1】「自分の作るゲーム名」か【2】毎回C++のプロジェクトを作るのが面倒な人は今回作るプロジェクトをフォルダごと量産するとして「DXLibGameBase」(ゲームの基礎ベース、コピペで量産用プロジェクト)にしましょう。</p>
    プロジェクトが作成されたら、とりあえずF5で実行して、ウィンドウが出ることを確認しましょう。 <br>
    
    <h2>次にプロジェクトのややこしい設定をしっかりやる</h2>
	プロジェクトの【設定を開く前に】最低限一つだけでもcppファイルがプロジェクトにないと【出てこない設定項目がある】ので新しい項目をついかでC++ソースファイル(.cpp)のファイルを一つ作成しておく。<br>
    <br>
    <p> <img src="image/need_one_cpp.png" alt="" style="width: 1152px; height: 713px;"></p>
    <br>
    一つだけcppファイルを作成した後、プロジェクトを右クリックして<code>プロパティ</code>をクリック<br>
    <br>
    <p> <img src="image/open_setting.png" alt="" style="width: 1128px; height: 642px;"></p>
    <br>    
    
    <h2>【設定】マルチバイト文字セットを使用</h2>
    <br>
    設定画面の【構成プロパティ】→【詳細】の【文字セット】を<code>マルチバイト文字セットを使用</code>に変更<br>
    <p> <img src="image/setting_multibyte_moji.png" alt="" style="width: 982px; height: 682px;"></p>
    <br>


    <h2>【設定】C/C++→全般→追加のインクルードディレクトリにDXライブラリのフォルダ位置(PATH)を追加</h2>
    <br>
    設定画面の【C/C++全般】→【全般】の【追加のインクルードディレクトリ】に<code>DXライブラリのフォルダ位置(PATH)</code>を設定<br>
    <p> <img src="image/setting_cpp_add_include_dir.png" alt="" style="width: 1047px; height: 682px;"></p>
    <br>
    フォルダのパス(位置)文字列は以下のgifアニメのようにコピーして貼り付け<br>
    <p> <img src="image/setting_howto_copy_dir.gif" alt="" style="width: 892px; height: 554px;"></p>
    <br>

    <h2>【設定】リンカ→全般→追加のライブラリディレクトリにDXライブラリのフォルダ位置(PATH)を追加</h2>
    <br>
    設定画面の【リンカー】→【全般】の【追加のライブラリディレクトリ】に<code>DXライブラリのフォルダ位置(PATH)</code>を設定<br>
    <p> <img src="image/setting_linker_add_lib_dir.png" alt="" style="width: 1046px; height: 682px;"></p>
    <br>
    フォルダのパス(位置)文字列は以下のgifアニメのようにコピーしたものを貼り付け<br>
    <p> <img src="image/setting_howto_paste_dir.gif" alt="" style="width: 1075px; height: 805px;"></p>
    <br>

<br>

    
    <h2>【設定】リンカ→システム→サブシステムをウィンドウに(コンソールのままだと黒画面の文字ベースシステムになる)</h2>
    
    <br>
    設定画面の【リンカー】→【システム】の【サブシステム】を<code>Windows(SUBSYSTEM:WINDOWS)</code>に設定<br>
    この設定をするとプログラムの開始位置(エントリポイントという)がWinMainというところから始まるようになる。(Consoleの場合はMain)<br>
    <p> <img src="image/setting_entry_point.png" alt="" style="width: 985px; height: 682px;"></p>
    <br>
    
    <br>
    以上で設定項目は終わり。OKをおして設定を反映しよう<br>

    <br>
<br>
	<h2>設定を反映させたらサンプルプログラムをmain.cppにコピペして動作を確認</h2>
    <p>以下の【ウィンドウを出すだけの最小限サンプル】を動かして設定を確認しましょう</p>
    <p><code>main.cpp【ウィンドウを出すだけの最小限サンプル】</code>を編集します：</p>
    <p class="source">#include "DxLib.h"<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( 960 , 540 , 32 ) ; // 画面サイズ960×540のカラービット数32ビットで起動<br>

&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(960, 540);// ウィンドウサイズ960×540(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>


&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;// この位置にウィンドウの中に画像を描く処理などを書く<br>
&nbsp;&nbsp;// DXライブラリ公式の色々なサンプルを試してみよう！<br>
&nbsp;&nbsp;// https://dxlib.xsrv.jp/dxfunc.html<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>


&nbsp;&nbsp;// キー入力待ちをする<br>
&nbsp;&nbsp;WaitKey();<br>

&nbsp;&nbsp;// ＤＸライブラリの後始末<br>
&nbsp;&nbsp;DxLib_End();<br>

&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>


    
    <h2>解像度の定義</h2>
    <p>【C++で】画面解像度を定義するクラスを作ってみましょう。ソリューションエクスプローラーのプロジェクトを右クリックし、追加＞ヘッダファイル(.h)<br>
      Screen.hという名前でヘッダファイルを生成し、そのファイルにクラスを記述します。</p>
    <p><code>Screen.h</code>を編集します：</p>
    <p class="source">#ifndef _SCREEN_H<br>
#define _SCREEN_H<br>
// ＃ifndefは「_SCREEN_H」がifもしもn(not) def(定義)されていないなら＃endifに挟まれたコードまでを有効化する(だから2度目以降は無効になる)<br>
// 二重定義を防止するために＃から始まる【プリプロセッサ】を使っている<br>
//　【プリプロセッサ】はビルドする段階でコード自体に【前処理】として影響を与える<br>
// たとえば<br>
// ・ファイルの読み込み (including) →＃includeがこれ<br>
// ・マクロの展開（シンボルを、あらかじめ定義された規則に従って置換する）<br>
// ・コンパイル条件によるソースコードの部分的選択→【＃ifndef　～ ＃endifに囲まれた部分】は一度(＃defineで)定義されると無効化<br>
// ・コメントの削除 【&nbsp;//&nbsp;】のコメントの削除も【プリプロセス＝前段階で行われる】<br>
<br>
// 画面解像度<br>
class Screen<br>
{<br>
public: //publicはC＃と違いpublic:以下にまとめて書かれるスタイル<br>
&nbsp;&nbsp;static const int Width = 960; // 幅<br>
&nbsp;&nbsp;static const int Height = 540; // 高さ C＃と違いstaticクラスではなく個々の【すべての変数にstaticをつけて】staticなクラスとする<br>
};// C＃と違ってクラスの定義も;セミコロンで終わる<br>

#endif</p>
<br>
<br>
<br>
    <p><code>main.cpp</code>を編集してScreen.hを読み込ませます：</p>
    <p class="source">#include "DxLib.h"<br>
    <em>#include "Screen.h"</em><br>
// ＃includeで別ファイルのヘッダファイル.hをこのコード内に読み込む<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( <em>Screen::Width, Screen::Height,</em> 32 ) ; // 画面サイズWidth×Heightのカラービット数32ビットで起動<br>
<br>
&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(<em>Screen::Width, Screen::Height</em>);// ウィンドウサイズWidth×Height(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>
<br>
&nbsp;&nbsp;// (中略).....................................<br>
<br>
&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>



    <h1><a id="mozTocId53452" class="mozTocH1"></a>画像ファイルの追加</h1>
    <p>次は画像ファイルをプロジェクトに追加します。【C#と違い】フォルダは【ウィンドウズ上のエクスプローラで作成】します。<br>
    <br>
    <br>
    <img src="image/open_folder_with_explorer.png" alt="" style="width: 1397px; height: 475px;"><br>
    <br>
    <img src="image/new_image_folder.png" alt="" style="width: 362px; height: 180px;"><br>
	<br>
	<br>
      「素材」フォルダー内の「画像」フォルダーにあるおなじみのボス画像を、【C#と違い】下のアニメようにウィンドウズでImageフォルダーにコピーして貼り付けしてください。</p>
    <img src="image/image_copy_paste.gif" alt=""><br>
    <br>
    <img src="image/image_add_project.gif" alt=""><br>

    <p><br>
    </p>
    
    <h2>試しに表示してみる</h2>
    <p><code>main.cpp</code>にプログラムを追加し、画像が正しく表示できるかテストします。</p>
    <p class="source">#include "DxLib.h"<br>
    <em>#include &lt;assert.h&gt;&nbsp;// 画像読み込みの読込み失敗表示用</em><br>
    #include "Screen.h"<br>
// ＃includeで別ファイルのヘッダファイル.hをこのコード内に読み込む<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( Screen::Width, Screen::Height, 32 ) ; // 画面サイズWidth×Heightのカラービット数32ビットで起動<br>
<br>
&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(Screen::Width, Screen::Height);// ウィンドウサイズWidth×Height(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>
<br>
<em>
&nbsp;&nbsp;//表示しているスクリーンの後ろで隠れて次に描く画像を先に描くモード<br>
&nbsp;&nbsp;// これとペアでScreenFlip();でつぎのページと入れ替えでちらつきを防ぐ<br>
&nbsp;&nbsp;SetDrawScreen(DX_SCREEN_BACK);<br>
<br>
&nbsp;&nbsp;// これまでInitでやってきてた初期化処理<br>
&nbsp;&nbsp;int bossImage = -1;<br>
&nbsp;&nbsp;bossImage = LoadGraph("Image/boss1.png");<br>
&nbsp;&nbsp;assert(bossImage != -1); // 画像読込失敗、ファイル名かフォルダ名が間違ってる<br>
&nbsp;&nbsp;int x = 100; // Xの初期位置<br>
&nbsp;&nbsp;int vx = 10;<br>
<br>
&nbsp;&nbsp;ScreenFlip();<br>
<br>
&nbsp;&nbsp;// アニメーション(パラパラ漫画)するにはWhile文<br>
&nbsp;&nbsp;while (ProcessMessage() == 0) <br>
&nbsp;&nbsp;{// ProcessMessage() == 0になるのは×ボタン押したときなど<br>
&nbsp;&nbsp;&nbsp;&nbsp;ClearDrawScreen();// 一旦キャンバスをきれいにまっさらに<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// これまではUpdateでやってきてた更新処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (x &lt; 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = 10; //速度の変更<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (x &gt; Screen::Width)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = -10;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;x += vx; // X位置の更新<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// これまではDrawでやってきてた描画処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;DrawRotaGraphF(x, 200, 0.9f, 0, bossImage, TRUE);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;ScreenFlip(); //隠れて裏側で描いておいた画像を表面に入れ替え<br>
&nbsp;&nbsp;}<br></em>
<br>

&nbsp;&nbsp;// キー入力待ちをする<br>
&nbsp;&nbsp;WaitKey();<br>

&nbsp;&nbsp;// ＤＸライブラリの後始末<br>
&nbsp;&nbsp;DxLib_End();<br>

&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>
    <p><br>
    </p>

    
    
    <h1><a id="mozTocId522169" class="mozTocH1"></a>Imageクラスの作成</h1>
    <h2>Imageクラスの作成</h2>
    <p>Imageクラスを作成しましょう。Imageクラスの役割は次の2つです。</p>
    <ul>
      <li>画像の読み込み</li>
      <li>読み込んだ画像ハンドルの保持</li>
    </ul>
    <p><br>
    </p>
    <p>ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞ヘッダファイル<br>
      「Image」という名前でヘッダファイルを作り、クラスを定義します。<br>
      <br>
      <code>Image.h</code>の内容を次のようにします：</p>
    <p class="source">#include "DxLib.h"<br>
    #include &lt;assert.h&gt;&nbsp;// 画像読み込みの読込み失敗表示用<br>
<br>
#ifndef IMAGE_H_<br>
#define IMAGE_H_<br>
<br>
class Image<br>
{<br>
public:<br>
&nbsp;&nbsp;Image() {}; // 初期化コンストラクタの定義だけ<br>
&nbsp;&nbsp;~Image() {}; // 破棄する処理デストラクタの定義だけ<br>
&nbsp;&nbsp;static void Load();<br>
<br>
&nbsp;&nbsp;static int bossImage; //ボス画像のハンドラ(読込画像番号)<br>
<br>
private:<br>
<br>
};<br>
#endif<br>
</p>
	  
	  
<br>
<p>次に対となるcppファイルを作成します。<br>
ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞cppファイル<br>
      「Image」という名前でcppファイルを作り、クラスを実装します。<br>
      <br>
      <code>Image.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Image.h"<br>
<br>
int Image::bossImage{-1}; // Load終わっても-1(初期値)のままだと画像ロードが失敗してますね<br>
<br>
void Image::Load()<br>
{<br>
&nbsp;&nbsp;bossImage = LoadGraph("Image/boss1.png");<br>
&nbsp;&nbsp;assert(bossImage != -1); // 画像読込失敗、ファイル名かフォルダ名が間違ってる<br>
}</p>

	  <br>
	  <br>
	  
<h2>試しに【Image.hを使って】表示してみる</h2>
    <p><code>main.cpp</code>のプログラムを変更し、画像が正しく表示できるかテストします。</p>
    <p class="source">#include "DxLib.h"<br>
    #include "Screen.h"<br>
    <em>#include "Image.h"&nbsp;// 画像読み込みクラス</em><br>
<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( Screen::Width, Screen::Height, 32 ) ; // 画面サイズWidth×Heightのカラービット数32ビットで起動<br>
<br>
&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(Screen::Width, Screen::Height);// ウィンドウサイズWidth×Height(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>
<br>
&nbsp;&nbsp;//表示しているスクリーンの後ろで隠れて次に描く画像を先に描くモード<br>
&nbsp;&nbsp;// これとペアでScreenFlip();でつぎのページと入れ替えでちらつきを防ぐ<br>
&nbsp;&nbsp;SetDrawScreen(DX_SCREEN_BACK);<br>
<br>
&nbsp;&nbsp;// これまでInitでやってきてた初期化処理<br>
&nbsp;&nbsp;<em>Image::Load();</em><br>
&nbsp;&nbsp;int x = 100; // Xの初期位置<br>
&nbsp;&nbsp;int vx = 10;<br>
<br>
&nbsp;&nbsp;ScreenFlip();<br>
<br>
&nbsp;&nbsp;// アニメーション(パラパラ漫画)するにはWhile文<br>
&nbsp;&nbsp;while (ProcessMessage() == 0) <br>
&nbsp;&nbsp;{// ProcessMessage() == 0になるのは×ボタン押したときなど<br>
&nbsp;&nbsp;&nbsp;&nbsp;ClearDrawScreen();// 一旦キャンバスをきれいにまっさらに<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// これまではUpdateでやってきてた更新処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (x &lt; 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = 10; //速度の変更<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (x &gt; Screen::Width)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = -10;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;x += vx; // X位置の更新<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// これまではDrawでやってきてた描画処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;DrawRotaGraphF(x, 200, 0.9f, 0, <em>Image::bossImage</em>, TRUE);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;ScreenFlip(); //隠れて裏側で描いておいた画像を表面に入れ替え<br>
&nbsp;&nbsp;}<br>
<br>

&nbsp;&nbsp;// キー入力待ちをする<br>
&nbsp;&nbsp;WaitKey();<br>

&nbsp;&nbsp;// ＤＸライブラリの後始末<br>
&nbsp;&nbsp;DxLib_End();<br>

&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>
    <p><br>
    </p>

	  <h1><a id="mozTocId522169" class="mozTocH1"></a>前期C#スタイルに近づく一歩！Gameクラスの作成</h1>
    <h2>Gameクラスの作成</h2>
    <p>Gameクラスを作成しましょう。Gameクラスの重要な役割は次の3つ。<br>
    これがあれば前期のようにGameクラスに処理を書いて開発できる！</p>
    <ul>
      <li>初期処理Init()</li>
      <li>更新処理Update()</li>
      <li>描画処理Draw()</li>
    </ul>
    <p><br>
    </p>
    <p>ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞ヘッダファイル<br>
      「Game」という名前でヘッダファイルを作り、クラスを定義します。<br>
      <br>
      <code>Game.h</code>の内容を次のようにします：</p>
    <p class="source">#ifndef GAME_H_<br>
#define GAME_H_<br>
<br>
#include "Image.h"<br>
#include "Screen.h"<br>
<br>
class Game<br>
{<br>
public :<br>
&nbsp; /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ↓{ 
	}を.hに書くことでcppに分けて書くはずの処理ぶぶんを.hに書いてもよい */<br>
&nbsp;&nbsp;Game() {&nbsp; }; // 初期化コンストラクタ<br>
&nbsp;&nbsp;~Game() {&nbsp; }; // 破棄処理デストラクタ<br>
&nbsp;&nbsp;void Init(); // Init処理(定義だけ)<br>
&nbsp;&nbsp;void Update(); // 更新処理(定義だけ)<br>
&nbsp;&nbsp;void Draw();// 描画処理(定義だけ)<br>
<br>
&nbsp;&nbsp;int x = 0; //staticじゃないintはここで=0で初期化できる<br>
&nbsp;&nbsp;int vx = 0;<br>
<br>
};<br>

#endif<br></p>
<br>
<p>次に対となるcppファイルを作成します。<br>
ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞cppファイル<br>
      「Game」という名前でcppファイルを作り、クラスの処理を実装します。<br>
      <br>
      <code>Game.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Game.h"<br>
<br>
void Game::Init()<br>
{// Init処理<br>
&nbsp;&nbsp;Image::Load(); //画像の読込み<br>
&nbsp;&nbsp;x = 100; // Xの初期位置<br>
&nbsp;&nbsp;vx = 10; // ボスの初期速度<br>
}<br>
<br>
void Game::Update()<br>
{// 更新処理<br>
<br>
&nbsp;&nbsp;if (x &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = 10; //速度の変更<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;else if (x &gt; Screen::Width)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = -10; //画面端で移動方向反転<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;x += vx; // ボス画像のX位置の更新<br>
	<br>
}<br>
<br>
void Game::Draw()<br>
{// 描画処理<br>
&nbsp;&nbsp;DrawRotaGraphF(x, 200, 0.9f, 0, Image::bossImage, TRUE);<br>
<br>
}</p>


<h2>では前期に近い【Gameクラスを使って】表示してみる</h2>
    <p><code>main.cpp</code>のプログラムを変更し、画像が正しくGameクラスで表示できるかテストします。</p>
    <p class="source">#include "DxLib.h"<br>
    #include "Screen.h"<br>
    #include "Image.h"&nbsp;// 画像読み込みクラス<br>
    <em>#include "Game.h"&nbsp;</em><br>
<br>
<br>
// 設定画面の【リンカー】→【システム】の【サブシステム】をWindows(SUBSYSTEM:WINDOWS)に設定するとWinMainからプログラムが開始する<br>
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)<br>
{<br>
&nbsp;&nbsp;// 画面モードの設定<br>
&nbsp;&nbsp;SetGraphMode( Screen::Width, Screen::Height, 32 ) ; // 画面サイズWidth×Heightのカラービット数32ビットで起動<br>
<br>
&nbsp;&nbsp;// ＤＸライブラリの初期化<br>
&nbsp;&nbsp;if (DxLib_Init() &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// エラーが発生したら直ちに終了<br>
&nbsp;&nbsp;&nbsp;&nbsp;return -1;<br>
&nbsp;&nbsp;}<br>

&nbsp;&nbsp;ChangeWindowMode(TRUE);//フルスクリーン表示かウィンドウ表示か<br>
&nbsp;&nbsp;SetMouseDispFlag(TRUE);// ここをFALSEにするとマウスカーソル非表示<br>
&nbsp;&nbsp;SetWindowSize(Screen::Width, Screen::Height);// ウィンドウサイズWidth×Height(こことSetGraphModeのサイズが異なると画像がゆがむ)<br>
&nbsp;&nbsp;SetMainWindowText("ゲームのウィンドウ名を変えるときはここ");//この行でエラーになったら【設定】マルチバイト文字セットが間違ってるかも<br>
<br>
&nbsp;&nbsp;//表示しているスクリーンの後ろで隠れて次に描く画像を先に描くモード<br>
&nbsp;&nbsp;// これとペアでScreenFlip();でつぎのページと入れ替えでちらつきを防ぐ<br>
&nbsp;&nbsp;SetDrawScreen(DX_SCREEN_BACK);<br>
<br>
&nbsp;&nbsp;// Init初期化処理<br>
&nbsp;&nbsp;<em>Game game; //Gameの定義と同時にC++ではコンストラクタで初期化される<br>
&nbsp;&nbsp;game.Init(); // gameのInit準備</em><br>
<br>
&nbsp;&nbsp;ScreenFlip();<br>
<br>
&nbsp;&nbsp;// アニメーション(パラパラ漫画)するにはWhile文<br>
&nbsp;&nbsp;while (ProcessMessage() == 0) <br>
&nbsp;&nbsp;{// ProcessMessage() == 0になるのは×ボタン押したときなど<br>
&nbsp;&nbsp;&nbsp;&nbsp;ClearDrawScreen();// 一旦キャンバスをきれいにまっさらに<br>
<br>   
&nbsp;&nbsp;&nbsp;&nbsp;// Update更新処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;<em>game.Update(); // gameの更新処理</em><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;// Draw描画処理<br>
&nbsp;&nbsp;&nbsp;&nbsp;<em>game.Draw();</em><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ScreenFlip(); //隠れて裏側で描いておいた画像を表面に入れ替え<br>
&nbsp;&nbsp;}<br>
<br>

&nbsp;&nbsp;// キー入力待ちをする<br>
&nbsp;&nbsp;WaitKey();<br>

&nbsp;&nbsp;// ＤＸライブラリの後始末<br>
&nbsp;&nbsp;DxLib_End();<br>

&nbsp;&nbsp;// ソフトの終了<br>
&nbsp;&nbsp;return 0;<br>
}</p>
    <p><br>
    </p>

	      <h1><a id="mozTocId522169" class="mozTocH1"></a>プレイヤを操作するには便利クラスInputクラスの移植が必須！</h1>
    <h2>Inputクラスの作成</h2>
    <p>Inputクラスを作成しましょう。InputクラスをC#から移植するときの落とし穴に注意。</p>
    <ul>
      <li>static int のstaticタイプの変数は.hだけではシンボリックエラーになるのでこのためだけに最低限.cppファイルを作成する必要がある</li>
    </ul>
	<p>
    </p>
    <p>ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞ヘッダファイル<br>
      「Input.h」という名前でヘッダファイルを作り、クラスを定義します。<br>
      <br>
      <code>Input.h</code>にC#のInput.csをコピーし、以下のC++移植の修正をします：</p>
    <p class="source"><em>#ifndef INPUT_H_<br>
#define INPUT_H_<br>
<br>
#include "DxLib.h"</em><br>
<br>
<br>
// 入力クラス<br>
class Input<br>
{<br>
<em>public:</em><br>
&nbsp;<em>&nbsp;</em>static int prevState; // 1フレーム前の状態<br>
&nbsp;<em>&nbsp;</em>static int currentState; // 現在の状態<br>
<br>
&nbsp;&nbsp;// 初期化。最初に1回だけ呼んでください。<br>
&nbsp;<em>&nbsp;</em>static void Init()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;prevState = 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;currentState = 0;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 最新の入力状況に更新する処理。<br>
&nbsp;&nbsp;// 毎フレームの最初に（ゲームの処理より先に）呼んでください。<br>
&nbsp;<em>&nbsp;</em>static void Update()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;prevState = currentState;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;currentState = <em>&nbsp;</em>GetJoypadInputState(<em>&nbsp;</em>DX_INPUT_KEY_PAD1);<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// ボタンが押されているか？<br>
&nbsp;<em>&nbsp;</em>static bool GetButton(int buttonId)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// 今ボタンが押されているかどうかを返却<br>
&nbsp;&nbsp;&nbsp;&nbsp;return (currentState &amp; buttonId) != 0;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// ボタンが押された瞬間か？<br>
&nbsp;<em>&nbsp;</em>static bool GetButtonDown(int buttonId)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// 今は押されていて、かつ1フレーム前は押されていない場合はtrueを返却<br>
&nbsp;&nbsp;&nbsp;&nbsp;return ((currentState &amp; buttonId) &amp; ~(prevState 
	&amp; buttonId)) != 0;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// ボタンが離された瞬間か？<br>
&nbsp;<em>&nbsp;</em>static bool GetButtonUp(int buttonId)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// 1フレーム前は押されていて、かつ今は押されている場合はtrueを返却<br>
&nbsp;&nbsp;&nbsp;&nbsp;return ((prevState &amp; buttonId) &amp; ~(currentState 
	&amp; buttonId)) != 0;<br>
&nbsp;&nbsp;}<br>
}<em>;&nbsp;//←【注意】クラス定義の終わりにはコロンが必要だよ！</em><br>
<br>
#endif<em>&nbsp;&nbsp;//ここでエラー出た人は↑【注意】の;コロン忘れ</em><br></p>
<br>
<p>次に対となるcppファイルを作成します。<br>
ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞cppファイル<br>
      「Input.cpp」という名前でcppファイルを作ります(たった2行の初期化static int変数の初期化のために必須)。<br>
      <br>
      <code>Input.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Input.h"<br>
<br>
int <em>Input::</em>prevState <em>{ 0 }</em>; // 1フレーム前の状態<br>
int <em>Input::</em>currentState <em>{ 0 }</em>; // 現在の状態<br>
<em>// ↑static intのときはこの行書かないとシンボリックエラーになる件(このためだけにcpp書かなきゃならん)</em><br>
<br>
</p>


	  <h1><a id="mozTocId522169" class="mozTocH1"></a>Playerクラスでプレイヤをキー入力(↑↓←→)で動かせるように</h1>
	  <h2>忘れずにプレイヤ画像はImageフォルダにコピー貼り付けしましょう。</h2>
    <p>Playerクラスを作成する前に、忘れずにプレイヤ画像はImageフォルダにコピー貼り付けしましょう。<br>
    Imageフォルダにコピーしたらプロジェクトで</p>
    <p>次は画像ファイルをプロジェクトに追加します。【C#と違いドラッグアンドドロップせず】画像は【プロジェクトを右クリックで「追加」→「既存の項目」で画像を追加】します。<br>
    <img src="image/player_image_add.gif" alt=""><br>

<br>
<code>Image.h</code>の内容を次のようにします：</p>
    <p class="source">#include "DxLib.h"<br>
    #include &lt;assert.h&gt;&nbsp;// 画像読み込みの読込み失敗表示用<br>
<br>
#ifndef IMAGE_H_<br>
#define IMAGE_H_<br>
<br>
class Image<br>
{<br>
public:<br>
&nbsp;&nbsp;Image() {}; // 初期化コンストラクタの定義だけ<br>
&nbsp;&nbsp;~Image() {}; // 破棄する処理デストラクタの定義だけ<br>
&nbsp;&nbsp;static void Load();<br>
<br>
&nbsp;&nbsp;static int bossImage; //ボス画像のハンドラ(読込画像番号)<br>
&nbsp;&nbsp;<em>static int player; //プレイヤ画像のハンドラ</em><br>
<br>
private:<br>
<br>
};<br>
#endif<br>
</p>
<br>
<p>次に対となるcppファイルも変更します。<br>
      <code>Image.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Image.h"<br>
<br>
int Image::bossImage{-1}; // Load終わっても-1(初期値)のままだと画像ロードが失敗してますね<br>
<em>int Image::player{-1};</em><br>
<br>
void Image::Load()<br>
{<br>
&nbsp;&nbsp;bossImage = LoadGraph("Image/boss1.png");<br>
&nbsp;&nbsp;assert(bossImage != -1); // 画像読込失敗、ファイル名かフォルダ名が間違ってる<br>
<br>
&nbsp;&nbsp;<em>player= LoadGraph("Image/player.png");<br>
&nbsp;&nbsp;assert(player!= -1); // 画像読込失敗、ファイル名かフォルダ名が間違ってる</em><br>
}</p>
<br>
<br>


    <h2>Playerクラスの作成</h2>
    <p>Playerクラスを作成しましょう。<br>
    Playerクラスをつくるだけで安心すると【落とし穴】があります。Game.cppでInput.Update();も忘れずに</p>
    <ul>
      <li>【プレイヤ画像が出ない】→Game.cppで【player.Draw();しましたか？】</li>
      <li>【プレイヤ画像が動かない1】→Game.cppで【player.Update();しましたか？】</li>
      <li>【プレイヤ画像が動かない2】→Game.cppで【Input.Update();しましたか？】</li>
    </ul>
    <p><br>
    </p>
    <p>ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞ヘッダファイル<br>
      「Player.h」という名前でヘッダファイルを作り、クラスを定義します。<br>
      <br>
      <code>Player.h</code>の内容を次のようにします：</p>
    <p class="source">#ifndef PLAYER_H_<br>
#define PLAYER_H_<br>
<br>
#include "DxLib.h"<br>
#include "Input.h"<br>
#include "Image.h"<br>
<br>
class Player<br>
{<br>
public:<br>
&nbsp;<em>&nbsp;</em>const float MoveSpeed = <em>6;</em> // 移動速度<br>
<br>
&nbsp;<em>&nbsp;</em>float x; // x座標<br>
&nbsp;<em>&nbsp;</em>float y; // y座標<br>
<br>
&nbsp;&nbsp;// コンストラクタ<br>
&nbsp;&nbsp;// x : 初期位置x<br>
&nbsp;&nbsp;// y : 初期位置y<br>
&nbsp;<em>&nbsp;</em>Player(float x, float y)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<em>this-&gt;x = x</em>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<em>this-&gt;y = y</em>;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 更新処理<br>
&nbsp;<em>&nbsp;</em>void Update()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;float vx = 0; // x方向移動速度<br>
&nbsp;&nbsp;&nbsp;&nbsp;float vy = 0; // y方向移動速度<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (Input::GetButton(<em>&nbsp;</em>PAD_INPUT_LEFT))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = -MoveSpeed; // 左<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (Input<em>::</em>GetButton(<em>&nbsp;</em>PAD_INPUT_RIGHT))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = MoveSpeed; // 右<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (Input<em>::</em>GetButton(<em>&nbsp;</em>PAD_INPUT_UP))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vy = -MoveSpeed; // 上<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (Input<em>::</em>GetButton(<em>&nbsp;</em>PAD_INPUT_DOWN))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vy = MoveSpeed; // 下<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;// 実際に位置を動かす<br>
&nbsp;&nbsp;&nbsp;&nbsp;x += vx;<br>
&nbsp;&nbsp;&nbsp;&nbsp;y += vy;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 描画処理<br>
&nbsp;<em>&nbsp;</em>void Draw()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;<em>&nbsp;</em>DrawRotaGraphF(x, y, 1, 0, <em>Image::</em>player<em>, TRUE</em>);<br>
&nbsp;&nbsp;}<br>
};<br>
<br>
#endif<br></p>
<br>

<p><code>Game.h</code>にPlayerを追加します：</p>
    <p class="source">#ifndef GAME_H_<br>
#define GAME_H_<br>
<br>
#include "Image.h"<br>
#include "Screen.h"<br>
<em>#include "Player.h"</em><br>
<br>
class Game<br>
{<br>
public :<br>
&nbsp; /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ↓{ 
	}を.hに書くことでcppに分けて書くはずの処理ぶぶんを.hに書いてもよい */<br>
&nbsp;&nbsp;Game() {&nbsp; }; // 初期化コンストラクタ<br>
&nbsp;&nbsp;~Game() {&nbsp; }; // 破棄処理デストラクタ<br>
&nbsp;&nbsp;void Init(); // Init処理(定義だけ)<br>
&nbsp;&nbsp;void Update(); // 更新処理(定義だけ)<br>
&nbsp;&nbsp;void Draw();// 描画処理(定義だけ)<br>
<br>
&nbsp;&nbsp;int x = 0; //staticじゃないintはここで=0で初期化できる<br>
&nbsp;&nbsp;int vx = 0;<br>
<br>
&nbsp;&nbsp;<em>Player player{ 100, Screen::Height / 2 }; // 自機の初期化</em><br>
};<br>
#endif</p>

<p>次にGame.cppファイルにUpdateとDraw処理を追加してプレイヤの動作を確認しましょう。<br>
      <br>
      <code>Game.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Game.h"<br>
<br>
void Game::Init()<br>
{// Init処理<br>
&nbsp;&nbsp;Image::Load(); //画像の読込み<br>
&nbsp;&nbsp;x = 100; // Xの初期位置<br>
&nbsp;&nbsp;vx = 10; // ボスの初期速度<br>
}<br>
<br>
void Game::Update()<br>
{// 更新処理<br>
<br>
&nbsp;&nbsp;<em>Input::Update();&nbsp;//【注意】これ忘れるとキー入力押してもキャラ動かない</em><br>
<br>
&nbsp;&nbsp;if (x &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = 10; //速度の変更<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;else if (x &gt; Screen::Width)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = -10; //画面端で移動方向反転<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;x += vx; // ボス画像のX位置の更新<br>
	<br>
&nbsp;&nbsp;<em>player.Update(); // プレイヤの更新【忘れるとプレイヤが動かない】</em><br>
}<br>
<br>
void Game::Draw()<br>
{// 描画処理<br>
&nbsp;&nbsp;DrawRotaGraphF(x, 200, 0.9f, 0, Image::bossImage, TRUE);<br>
<br>
&nbsp;&nbsp;<em>player.Draw(); // プレイヤの更新【忘れるとプレイヤ表示されない】</em><br>
}</p>

<p>さて、無事にプレイヤをキー入力(↑↓←→)で動かせるようになりましたか？？？。</p><br>	  

	  
<h2>√2の定義</h2>
    <p>【C++でも】斜め方向の移動速度を√2で割って補正するために、自分用数学定義クラスを作ってみましょう。ソリューションエクスプローラーのプロジェクトを右クリックし、追加＞ヘッダファイル(.h)<br>
      MyMath.hという名前でヘッダファイルを生成し、そのファイルにクラスを記述します。</p>
    <p><code>MyMath.h</code>を編集します：</p>
    <p class="source">#ifndef _MYMATH_H<br>
	#define _MYMATH_H<br>
	// 数学関連クラス<br>class MyMath<br>{<br>
	public: <br>
&nbsp; // C ++標準では、静的static定数の【整数型】または【列挙型】のみをクラス内で初期化できます。<br>&nbsp; // 
	これが、一部の初期化が許可されているのに他のstatic floatなどが初期化できない理由です。<br><br>&nbsp; // 【OH,ノー】 
	float小数を定義するためだけにcppファイルを作成しないと<br>&nbsp; //static const float Sqrt2 
	=【このイコールでエラー】 1.41421356237f; <br><br>&nbsp; // ルート2(変数名の定義だけ)<br>static 
	const float Sqrt2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
	// = 1.41421356237f;<br><br>}; // 【注意】セミコロン抜けで【宣言が必要ですエラー】<br><br>#endif // 
	【宣言が必要ですエラーは上のセミコロン抜け】</p>
<br>
<br>
<br>
    <p><code>MyMath.cpp</code>を編集して変数名に1.41421356237f を 割り当てMath。</p>
    <p class="source">#include "MyMath.h"<br>
	<br>
	const float MyMath::Sqrt2 = 
	1.41421356237f;//(floatは有効桁は実質7桁まで正確だがそれ以降は環境によって誤差出る)<br>
<br>
	// 【ルールとして.hでfloatなどstatic小数などの初期化許さなかった理由】<br>// 一言でいうと 「作った人がそういうルールにした」<br>
	// 以下を一言でまとめると「.hヘッダはマシン環境によって変わるようなことは記述しないようにしたかった」<br>// 
	PCやマシン語翻訳コンパイラによって小数の精度などや数値に誤差が出るから<br>// 
	環境によって変動する可能性のあるfloatなど(int整数は誤差がない)<br>// をstatic 
	const静的定数として.hヘッダで初期化することを許可しなかった(定数といえない) 「マシン依存」<br>// 
	cppで大丈夫なのはcppは実際の処理ベースで動くので【動的な動いてもよい数字となるから】(どの環境でも同じとは限らない)<br>// 
	【勉強】以下サイトにC++のBjarneさんの説明を翻訳したものがある<br>// 
	https://qastack.jp/programming/9656941/why-cant-i-initialize-non-const-static-member-or-static-array-in-class</p>



    <p><br>
      <br>
      定義だけじゃなく、実際にプレイヤを動かしているPlayer.hも編集しなきゃ意味がないよ！お忘れなく！！<br>
      <code>Player.h</code>の内容を次のようにします：</p>
    <p class="source">#ifndef PLAYER_H_<br>
#define PLAYER_H_<br>
<br>
#include "DxLib.h"<br>
#include "Input.h"<br>
#include "Image.h"<br>
<br>
class Player<br>
{<br>
public:<br>
&nbsp;const float MoveSpeed = 6; // 移動速度<br>
<br>
&nbsp;float x; // x座標<br>
&nbsp;float y; // y座標<br>
<br>
&nbsp;&nbsp;// コンストラクタ<br>
&nbsp;&nbsp;// x : 初期位置x<br>
&nbsp;&nbsp;// y : 初期位置y<br>
&nbsp;Player(float x, float y)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this-&gt;x = x;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this-&gt;y = y;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 更新処理<br>
&nbsp;void Update()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;float vx = 0; // x方向移動速度<br>
&nbsp;&nbsp;&nbsp;&nbsp;float vy = 0; // y方向移動速度<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (Input::GetButton(PAD_INPUT_LEFT))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = -MoveSpeed; // 左<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (Input::GetButton(PAD_INPUT_RIGHT))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx = MoveSpeed; // 右<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (Input::GetButton(PAD_INPUT_UP))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vy = -MoveSpeed; // 上<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;else if (Input::GetButton(PAD_INPUT_DOWN))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vy = MoveSpeed; // 下<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<em>// 斜め移動も同じ速度になるように調整<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (vx != 0 &amp;&amp; vy != 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vx /= MyMath::Sqrt2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vy /= MyMath::Sqrt2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</em><br>
&nbsp;&nbsp;&nbsp;&nbsp;// 実際に位置を動かす<br>
&nbsp;&nbsp;&nbsp;&nbsp;x += vx;<br>
&nbsp;&nbsp;&nbsp;&nbsp;y += vy;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;// 描画処理<br>
&nbsp;void Draw()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;DrawRotaGraphF(x, y, 1, 0, Image::player, TRUE);<br>
&nbsp;&nbsp;}<br>
};<br>
<br>
#endif<br></p>
<br>
<br>
<br>	  
    <h2>自機弾PlayerBulletクラスの作成</h2>
    <p>PlayerBulletクラスを作成しましょう。<br>
    </p>
    <p>ソリューションエクスプローラーからプロジェクトを右クリックし、追加＞ヘッダファイル<br>
      「PlayerBullet.h」という名前でヘッダファイルを作り、クラスを定義します。<br>
      <br>
      <code>PlayerBullet.h</code>の内容を次のようにします：</p>
    <p class="source">#ifndef PLAYERBULLET_H_<br>
#define PLAYERBULLET_H_<br>
<br>
#include "DxLib.h"<br>
#include "Image.h"<br>
<br>
// 自機弾クラス<br>
class PlayerBullet<br>
{<br>
public:<br>
&nbsp;&nbsp;const float Speed = 25; // 移動速度<br>
<br>
&nbsp;&nbsp;float x; // x座標<br>
&nbsp;&nbsp;float y; // y座標<br>
<br>
&nbsp;&nbsp;// コンストラクタ<br>
&nbsp;&nbsp;PlayerBullet(float x, float y)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this-&gt;x = x;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this-&gt;y = y;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 更新処理<br>
&nbsp;&nbsp;void Update()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// 移動<br>
&nbsp;&nbsp;&nbsp;&nbsp;x += Speed;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 描画処理<br>
&nbsp;&nbsp;void Draw()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;DrawRotaGraphF(x, y, 1, 0, Image::playerBullet,TRUE);<br>
&nbsp;&nbsp;}<br>
};<br>
<br>
<br>
#endif<br></p>


<br>

<p><code>Game.h</code>にPlayerBulletを追加します：</p>
    <p class="source">#ifndef GAME_H_<br>
#define GAME_H_<br>
<br>
<em>#include&nbsp;&lt;vector&gt;//C#のListリストの代わりのC++版<br>
#include&nbsp;&lt;memory&gt;//スマートなポインタを使うのに必要(shared_ptrなど)</em><br>
<br>
#include&nbsp;"Image.h"<br>
#include&nbsp;"Screen.h"<br>
#include&nbsp;"PlayerBullet.h"<br>
<br>
<em>#include&nbsp;"Player.h"<br>
<br>
class&nbsp;Player;//←【エラー地獄に注意！】ここにPlayerクラスがあるものとして書くことで【循環相互インクルードどうぞどうぞ問題】を回避</em><br>
<br>
class&nbsp;Game<br>
{<br>
public&nbsp;:<br>
&nbsp;&nbsp;Game()&nbsp;{}; // 初期化コンストラクタ<br>
&nbsp;&nbsp;~Game()&nbsp;{}; // 破棄処理デストラクタ<br>
&nbsp;&nbsp;void Init(); // Init処理(定義だけ)<br>
&nbsp;&nbsp;void Update(); // 更新処理(定義だけ)<br>
&nbsp;&nbsp;void Draw();// 描画処理(定義だけ)<br>
<br>
&nbsp;&nbsp;int x = 0;<br>
&nbsp;&nbsp;int vx = 0;<br>
<br>
&nbsp;&nbsp;<em>std::shared_ptr&lt;Player&gt;&nbsp;player{ std::make_shared&lt;Player&gt;(100, Screen::Height / 2, this) }; // 自機の初期化</em><br>
&nbsp;&nbsp;<em>//↑プレイヤも回し読みポインタ型に。std::make_shared&lt;Player&gt;でメモリ上に実体を生成<br>
&nbsp;&nbsp;std::vector&lt;std::shared_ptr&lt;PlayerBullet&gt;&gt; playerBullets; // 自機弾のリスト</em><br>
&nbsp;&nbsp;//&nbsp;List↑と同じvector&nbsp;↑【shared_ptr】<br>
<br>
&nbsp;&nbsp;//&nbsp;★【shared_ptr】とは<br>
&nbsp;&nbsp;//&nbsp;「兄弟で週刊少年ジャンプを【回し読みする】が<br>
&nbsp;&nbsp;//&nbsp;おかんに【全員読み終わるまでは捨てられないように】するため<br>
&nbsp;&nbsp;//&nbsp;【読むつもりの人カウンタ】がゼロになると【おかんに捨てられる】」<br>
<br>
};<br>
<br>
#endif</p>

<p>次にGame.cppファイルにUpdateとDrawに自機弾更新と描画の処理を追加しましょう。<br>
      <br>
      <code>Game.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Game.h"<br>
<br>
void Game::Init()<br>
{// Init処理<br>
<br>
&nbsp;&nbsp;Image::Load(); //画像の読込み<br>
&nbsp;&nbsp;x = 100; // Xの初期位置<br>
&nbsp;&nbsp;vx = 10;<br>
};<br>
<br>
void Game::Update()<br>
{// 更新処理<br>
<br>
&nbsp;&nbsp;Input::Update(); //【注意】これ忘れるとキー入力押してもキャラ動かない<br>
<br>
&nbsp;&nbsp;if (x &lt; 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = 10; //速度の変更<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;else if (x &lt; Screen::Width)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = -10;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;x += vx; // X位置の更新<br>
<br>
&nbsp;&nbsp;player-&lt;Update(); // プレイヤの更新【忘れるとプレイヤが動かない】<br>
<br>
&nbsp;&nbsp;<em>// 自機弾の更新処理<br>
&nbsp;&nbsp;// C#のforeach文と同じく全自機弾を更新できる<br>
&nbsp;&nbsp;for (const auto&amp; b : playerBullets)<br>
&nbsp;&nbsp;{&nbsp;&nbsp;// autoキーワードはビルドのコンパイル機械語翻訳の時に型を自動推論してくれる<br>
&nbsp;&nbsp;&nbsp;&nbsp;b-&gt;Update();<br>
&nbsp;&nbsp;}</em><br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<em>//【放置厳禁！！！このままここに弾削除処理書かないとメモリがどんどん減ってくよ(気づかないうちにね..怖)】</em><br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>

};<br>
<br>
void Game::Draw()<br>
{// 描画処理<br>
&nbsp;&nbsp;DrawRotaGraphF(x, 200, 0.9f, 0, Image::bossImage, TRUE);<br>
<br>
&nbsp;&nbsp;player-&gt;Draw(); // プレイヤの更新【忘れるとプレイヤ表示されない】<br>
<br>
&nbsp;&nbsp;<em>// 自機弾の描画処理<br>
&nbsp;&nbsp;// C#のforeach文と同じく全自機弾を更新できる<br>
&nbsp;&nbsp;for (const auto&amp; b : playerBullets)<br>
&nbsp;&nbsp;{&nbsp;&nbsp;// autoキーワードはビルドのコンパイル機械語翻訳の時に型を自動推論してくれる<br>
&nbsp;&nbsp;&nbsp;&nbsp;b-&gt;Draw();<br>
&nbsp;&nbsp;}</em><br>
};<br>
</p>
<br>
<br>
<br>


<p><code>Player.h</code>にPlayerBulletを追加します：</p>
    <p class="source">#ifndef PLAYER_H_<br>
#define PLAYER_H_<br>
<br>
#include "DxLib.h"<br>
#include "Input.h"<br>
#include "Image.h"<br>
#include "MyMath.h"<br>
<br>
<em>#include "Game.h"<br>
<br>
class Game;//←【エラー地獄に注意！】ここにGameクラスがあるものとして書くことで【循環相互インクルードどうぞどうぞ問題】を回避<br>
<br>
//↑Gameクラス内にPlayer変数を持っているからPlayerの定義が終わらないとGameの定義が完了しない(未定義エラー)<br>
//【なのに】Playerクラス内にGame変数を持っているからPlayerの定義も終わらない！！(未定義エラー)<br>
//【つまりPlayerとGameが互いに定義が終わるのを待つ】【循環相互インクルードどうぞどうぞ状態】になる<br>
//【解決するために】とりあえずclass Game;とだけここに書いてGameは定義完了済と見せかけているわけです！<br>
//[エラー:Playerは未定義です]とか[エラー:Gameは未定義です]とか定義してるはずのものが未定義の場合は大体これ！！</em><br>
<br>
class Player<br>
{<br>
public:<br>
&nbsp;&nbsp;const float MoveSpeed = 6; // 移動速度<br>
<br>
&nbsp;&nbsp;float x; // x座標<br>
&nbsp;&nbsp;float y; // y座標<br>
<br>
&nbsp;&nbsp;<em>Game* game { nullptr }; // Gameのインスタンスの参照<br>
&nbsp;&nbsp;//↑*ポインタ型です！プレイヤの【内部に】ゲームの情報を【メモリ実体として持つ】と<br>
&nbsp;&nbsp;//そのプレイヤを親のゲームがもつと【延々とループで終わりなきメモリ爆発ループ】になるから<br>
&nbsp;&nbsp;//メモリに対しての参照=【レコードの針をGameに指して】【Gameの住所アドレスだけをプレイヤ内部に持つ】</em><br>
<br>
&nbsp;&nbsp;// コンストラクタ<br>
&nbsp;&nbsp;// x : 初期位置x<br>
&nbsp;&nbsp;// y : 初期位置y<br>
&nbsp;&nbsp;<em>Player(float x, float y, Game* game) : x{ x }, y{ y }, game{ game }<br>
&nbsp;&nbsp;{};</em>//↑別バージョン初期化コンストラクタ(this-&gt;x = x;やらないバージョン)<br>
<br>
&nbsp;&nbsp;// 更新処理<br>
&nbsp;&nbsp;void Update();<br>  
<br>
&nbsp;&nbsp;// 描画処理<br>
&nbsp;&nbsp;void Draw();<br>
<br>
};<br>
<br>
#endif</p>

<p>次にPlayer.cppファイルに弾を打つプログラムを追加してプレイヤが弾を打てるようにしましょう。<br>
      <br>
      <code>Player.cpp</code>の内容を次のようにします：</p>
    <p class="source">#include "Player.h"<br>
<br>
// 更新処理<br>
void Player::Update()<br>
{<br>
&nbsp;&nbsp;float vx = 0; // x方向移動速度<br>
&nbsp;&nbsp;float vy = 0; // y方向移動速度<br>
<br>
&nbsp;&nbsp;if (Input::GetButton(PAD_INPUT_LEFT))<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = -MoveSpeed; // 左<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;else if (Input::GetButton(PAD_INPUT_RIGHT))<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vx = MoveSpeed; // 右<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;if (Input::GetButton(PAD_INPUT_UP))<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vy = -MoveSpeed; // 上<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;else if (Input::GetButton(PAD_INPUT_DOWN))<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vy = MoveSpeed; // 下<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 斜め移動も同じ速度になるように調整<br>
&nbsp;&nbsp;if (vx != 0 &amp;&amp; vy != 0)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;vx /= MyMath::Sqrt2;<br>
&nbsp;&nbsp;vy /= MyMath::Sqrt2;<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;// 実際に位置を動かす<br>
&nbsp;&nbsp;x += vx;<br>
&nbsp;&nbsp;y += vy;<br>
<br>
&nbsp;&nbsp;<em>// ボタン押下で自機弾を発射<br>
&nbsp;&nbsp;if (Input::GetButtonDown(PAD_INPUT_1))<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;【C#版】game-&gt;playerBullets.Add(new PlayerBullet(x, y));<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;C++ではAddがpush_backに↓&nbsp;newがmake_shared↓に<br>
&nbsp;&nbsp;&nbsp;&nbsp;game-&gt;playerBullets.push_back(std::make_shared<PlayerBullet>(x, y));<br>  
&nbsp;&nbsp;}</em><br>
}<br>
<br>
// 描画処理<br>
void Player::Draw()<br>
{<br>
&nbsp;&nbsp;DrawRotaGraphF(x, y, 1, 0, Image::player, TRUE);<br>
}<br>
</p><br>
<br>
<br>
<br>
<br>
<p>【確認してみましょう】ここまでで一旦弾が打てるかチェックしてみましょう！【弾のメモリは削除されないバージョンなので要注意！！】<br>
<br>
<br>
<br>
	    
<h2>とりあえずC++バージョンに変更できたのはここまで</h2>



</body>
</html>
